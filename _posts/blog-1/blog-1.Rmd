---
title: "COVID-19 Italy"
description: |
  This blog post explores the current situation of COVID-19 in Italy.
author:
  - name: XITONG HE
    affiliation: Monash University
date: 08-31-2020
output:
  distill::distill_article:
    self_contained: false
bibliography: references.bib
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,message = FALSE,warning = FALSE,fig.align="center")
library(covid19italy)
library(dplyr)
library(tidyverse)
library(lubridate)
library(DT)
library(sparkline)
library(kableExtra)
library(formattable)
library(htmlwidgets)
library(htmltools)
```



Italy is experienced the serious coronavirus disaster, especially the out-of-control in March. In this post, I am going to analyze the situation in this epidemic in Italy.\

# Data description

There are three data sets used on this analysis, and the cleaned data is obtained from [GitHub RamiKrispin](https://github.com/RamiKrispin/covid19Italy). In addition, the `covid19italy` package is created by Rami Krispin @covid19italy as well which is provided a tidy format dataset of the 2019 Novel Coronavirus COVID-19 (2019-nCoV) pandemic outbreak in Italy.\

The three datasets are shown as below:\

-  **italy_total** - daily summary of the outbreak on the national level\

-  **italy_region**- daily summary of the outbreak on the region level\

-  **italy_province** - daily summary of the outbreak on the province level\

These three datasets is collected the information from 2020-02-24 until now, updating daily by daily data information. Overall, Italy has the *265,409* total case of COVID-19 until now. \

# Analyse in Italy

**Figure \@ref(fig:region-table)** shows the number of active, recovered,death and total case in each region in Italy from 2020-02-24 until now. Lombardia has the most of cases in all attributes and the death case are more than 10,000 which is almost the twice of Piemonte. The reason for this phenomenon with highest death in Lombardia due to the possible delayed public health response, high urban density and considerable elderly population which is difficult to control transmission between asymptomatic individuals at the community level so it makes the situation worst than other regions @odone2020covid. And Basilicata has the less cases in all 21 regions,which has been announced early to the travelers who has to pre-register by filling out a designed form which shows where they will be staying and when will they depart, as part of efforts to halt the spread of the Coronavirus pandemic (COVID-19).\


```{r read-data}
italy_region<-read.csv(here::here("data/italy_region.csv"))
italy_province<-read.csv(here::here("data/italy_province.csv"))
italy_total<-read.csv(here::here("data/italy_total.csv"))
```


```{r region-wrangling-data}


region_case<-italy_region %>% 
  filter(date == max(date)) %>% 
  select(region_name, cumulative_positive_cases, recovered, death, cumulative_cases) %>%
  arrange(-cumulative_positive_cases) %>%
  mutate(region = factor(region_name, levels = region_name))->region_case
#sorted <- region_case[order(region_case$region, decreasing= TRUE),]
italy_region %>% 
  filter(date == max(date)) %>% 
  select(region_name, cumulative_positive_cases, recovered, death,cumulative_cases)%>% rename(
    Region = region_name,
    Active = cumulative_positive_cases,
    `Total case`=cumulative_cases
    )->region_count
```

```{r region-table,fig.cap="COVID-19 case in different region in Italy "}

DT::datatable(region_count, options = list(pageLength = 7),filter = 'top')%>%
    formatStyle(
    'death',
    background = styleColorBar(region_case$death, 'steelblue'),
    backgroundSize = '98% 88%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  ) 
```


The overall cases cross time in Italy as displayed in the **Figure \@ref(fig:summary)**. Overall there are 265,409 confirmed cases, 206,554 recovered case and 35,463 deaths case. The active cases in Italy have a massive upsurge which are shown in the February and March, marking the biggest coronavirus outbreak outside Asia. In addition, the death rate and recovery rate have soared in March compared with February and after that the death rate has stabilized at 14%. In April, the active cases continue to rise sharply and after a peak then flat out at the end of this month. Started from May to July, Italian government took a series of measures such as the social distancing and travel restriction to significantly ease the spread of the coronavirus @gatto2020spread. Because of these strict measures, the active cases have gradually decreased as well as the recovery rate have increased rapidly after April as many patients have been cured. However, from the line graph in August, the active cases represent a gradually growth, the reason may be raised by holidays and night life for causing people to gather in numbers from some experts explained. Due to the active case has rise significantly again, the recovery rate has drop slightly as well.



```{r summary,fig.cap="COVID-19 cases cross time"}
italy_total%>%
  mutate(month=month(date))%>%
  select(month,cumulative_positive_cases,recovered,death,cumulative_cases)%>%
  group_by(month)%>%
  filter(cumulative_cases==max(cumulative_cases))%>%
  rename(
    Month=month,
    Active = cumulative_positive_cases,
    `Total case`=cumulative_cases,
    Recovered=recovered,
    Death=death
    )%>%
  mutate(`Recovery rate`=(Recovered/`Total case`)*100,
    `Death rate`=(Death/`Total case`)*100)->italy

active_sparkline<-italy_total%>%
  mutate(year = year(date),month=month(date))%>%
  select(month,cumulative_positive_cases)%>%
  rename(Month=month)%>%
  group_by(Month)%>%
  summarise(`Active case` = spk_chr(cumulative_positive_cases, type = "line")) 

italy_summary<-left_join(italy,active_sparkline,by="Month")

out = as.htmlwidget(formattable(italy_summary,
            list(`Active` = color_bar("#FA614B"), 
                 `Death rate` = formatter("span", 
                                          x ~ percent(x / 100),
                                          style = x ~ style(color = ifelse(x, 3, "red"))),
                 `Recovery rate` = formatter("span", 
                                             x ~ percent(x / 100),
                                             style = x ~ style(color = ifelse(x, 3, "red"))))))
out$dependencies = c(out$dependencies, htmlwidgets:::widget_dependencies("sparkline", "sparkline"))
out
```

In the **Table \@ref(tab:statistic)**, the summary statistics is constructed by daily positive case which is separated in region and total data. In  the region data, the minimum of daily positive cases is -5339 while the minimum of total data is -6939 but it seems to close to region. The negative value in the summary statistic means the number of people are recovery from the hospital and home confinement. However, the median of region daily positive case is 0,indicating that the middle value in daily positive case compared with each region is 0. 


```{r statistic,fig.cap="Daily positive case summary statistic"}

summary_function <- function(x,daily){
  summary(daily[x]) %>% 
  as.data.frame() %>% 
  separate(col = Freq, into = c("stat","value"),sep = ":") %>% 
  pivot_wider(names_from = "stat", values_from = "value")
}

bind_rows(summary_function(7,italy_total)) %>% 
  select(-Var1) %>% 
  janitor::clean_names() %>% 
  mutate(var2 = recode(var2, 
                       "daily_positive_cases" = "Total"),
         min=format(as.numeric(min),nsmall =   1),
         x1st_qu=format(as.numeric(x1st_qu),nsmall = 1),
         median=format(as.numeric(median),nsmall =  1),
         mean=round(as.numeric(mean),digits=1),
         x3rd_qu=round(as.numeric(x3rd_qu),digits = 1),
         max=format(as.numeric(max),nsmall =  1)) ->total

bind_rows(summary_function(11,italy_region)) %>% 
  select(-Var1) %>% 
  janitor::clean_names() %>% 
  mutate(var2 = recode(var2, 
                       "daily_positive_cases" = "Region"),
         min=format(as.numeric(min),nsmall =   1),
         x1st_qu=format(as.numeric(x1st_qu),nsmall = 1),
         median=format(as.numeric(median),nsmall =  1),
         mean=round(as.numeric(mean),digits=1),
         x3rd_qu=round(as.numeric(x3rd_qu),digits = 1),
         max=format(as.numeric(max),nsmall =  1)) ->region


rbind(region,total)%>%
 kable(col.names = c("Daily postive case", "Min.", "1st Qu.", "Median", "Mean", "3rd Qu.", "Max."),
       align = "lrrrrrr",
       booktabs=TRUE,
       caption = "Daily positive case summary statistic")%>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

# Acknowlegments

I would like to thank all the contributors to the following R package: @tidyverse, @here, @dplyr,@DT,@covid19italy,@sparkline,@htmlwidgets,@formattable,@kableExtra,@lubridate.
